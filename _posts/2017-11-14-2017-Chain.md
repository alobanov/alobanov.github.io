---
layout: post
title: –í–∞–ª–∏–¥–∏—Ä—É–µ–º
description: –¶–µ–ø–æ—á–∫–∞ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π
categories: article
tags:
  - composite
  - ios
  - swift
---

---

> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–æ–∫—É –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏, –∞ –∑–∞—Ç–µ–º –¥–ª—è –Ω–∏—Ö –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü—Ä–∏—á–µ–º –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ö–æ—á–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫–∞–∫ —É–≥–æ–¥–Ω–æ, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏. –í —ç—Ç–æ–º –Ω–∞–º –Ω–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω [**¬´–¶–µ–ø–æ—á–∫–∞ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π¬ª**][5].

<br />

–ù–∞–ø—Ä–∏–º–µ—Ä –Ω–∞–º –Ω–∞–¥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Å —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º –∏ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–µ. –û–ø–∏—à–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –º—ã —Ö–æ—Ç–∏–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

- –°—Ç—Ä–æ–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—É—Å—Ç–æ–π –∏ –Ω–µ <span class="wordcode">nil</span>
- –°—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Å —É—á–µ—Ç–æ–º —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

> **–¶–µ–ø–æ—á–∫–∞ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π** ‚Äî —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–æ —Ü–µ–ø–æ—á–∫–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –ö–∞–∂–¥—ã–π –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ—à–∞–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –æ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Å–∞–º –∏ —Å—Ç–æ–∏—Ç –ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–∏.

Playground —Å [–ø—Ä–∏–º–µ—Ä–æ–º][2] –Ω–∞ Git-Hub :dog:

<br />

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

<ol class="custom-counter">
  <li>
  –û–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ <span class="wordcode">MiddlewareProtocol</span>:
{% highlight swift %}
protocol MiddlewareProtocol {
  // –°–≤—è–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
  @discardableResult func link(with: MiddlewareProtocol) -> MiddlewareProtocol
  // –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å, –≤ –Ω–µ–º –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤—Å—è –ª–æ–≥–∏–∫–∞
  func check(value: MiddlewareItem) -> MiddlewareItem
  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –≤—ã–∑–æ–≤–∞ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ü–µ–ø–æ—á–∫–µ
  func checkNext(value: MiddlewareItem) -> MiddlewareItem
}
{% endhighlight %}
  </li>
  <li>
  –î–æ–±–∞–≤–∏–º –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ <span class="wordcode">MiddlewareItem</span> -- —ç—Ç–æ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∞–º–æ –∑–Ω–∞—á–µ–Ω–∏–µ <span class="wordcode">.value</span> –∏ –æ—à–∏–±–∫—É <span class="wordcode">.error</span> –µ—Å–ª–∏ –º—ã –Ω–µ –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é:
{% highlight swift %}
public enum MiddlewareItem {
  case value(String?)
  case error(String)
}
{% endhighlight %}
  </li>
  <li>
  –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ <span class="wordcode">MiddlewareProtocol</span>:

{% highlight swift %}
class Middleware: MiddlewareProtocol {
  var next: MiddlewareProtocol?

  @discardableResult func link(with: MiddlewareProtocol) -> MiddlewareProtocol {
    self.next = with
    return with
  }

  func check(value: MiddlewareItem) -> MiddlewareItem {
    return checkNext(value: value)
  }

  func checkNext(value: MiddlewareItem) -> MiddlewareItem {
    guard let next = self.next else { return value }
    return next.check(value: value)
  }
}
{% endhighlight %}
  </li>
</ol>

#### –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç Middleware

–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞:

1. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ <span class="wordcode">nil</span> –∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É: <span class="wordcode">CheckNilMiddleware</span>
2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥–ª–∏–Ω–Ω—É —Å—Ç—Ä–æ–∫–∏: <span class="wordcode">CheckCountMiddleware</span>
3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É —Å —É—á–µ—Ç–æ–º —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞: <span class="wordcode">PhoneFormatterMiddleware</span>

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è [–≤—Å–µ—Ö —Ç—Ä–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –æ–ø–∏—Å–∞–Ω—ã—Ö –≤—ã—à–µ][1] :cat:

<br/>

---

## –†–∞–∑–±–µ—Ä–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ

1. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç <span class="wordcode">Middleware</span>
2. –ü–µ—Ä–µ–≥—Ä—É–∂–µ–º –º–µ—Ç–æ–¥ <span class="wordcode">check(value: MiddlewareItem) -> MiddlewareItem</span> –∏ –æ–ø–∏—Å—ã–≤–∞–µ–º –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–æ–∫, –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏ <span class="wordcode">.value(let val)</span>.
3. –ï—Å–ª–∏ –≤—Å–µ —É—Å–ø–µ—à–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –Ω–∞—à–µ–º —Å–ø–∏—Å–∫–µ —Ü–µ–ø–æ—á–µ–∫ <span class="wordcode">return checkNext(value: value)</span>
  * –ï—Å–ª–∏ —Ö–æ—Ç–∏–º –ø—Ä–µ—Ä–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É <span class="wordcode">return .error("Example error text")</span>.
  * –ï—Å–ª–∏ —Ö–æ—Ç–∏–º –ø–æ–¥–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ <span class="wordcode">return checkNext(value: .value("New value"))</span>

{% highlight swift %}
override func check(value: MiddlewareItem) -> MiddlewareItem {
    switch value {
    case .value(let str):
      if str == nil { // –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
        return .error("Example error text")
      }
    default:
      break
    }
    // –ï—Å–ª–∏ –≤—Å–µ —É—Å–ø–µ—à–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é
    // –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –Ω–∞—à–µ–º —Å–ø–∏—Å–∫–µ —Ü–µ–ø–æ—á–µ–∫
    return checkNext(value: value)
  }
{% endhighlight %}

<small> –°–º–æ—Ç—Ä–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–¥—É</small> üëÜ

<br/>

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

{% highlight swift %}
let start = Middleware()
start
  .link(with: CheckNilMiddleware())
  .link(with: CheckCountMiddleware(length: 11))
  .link(with: PhoneFormatterMiddleware(format: "+X (XXX) XXX XX-XX"))

let result = start.check(value: .value("79634480209")))

switch result {
case .error(let error): print(error)
case .value(let result): print(result ?? "")
}
{% endhighlight %}

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–º–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –º–∞–≥–∏–∏, –¥–æ–±–∞–≤–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä <span class="wordcode">|></span>

{% highlight swift %}
precedencegroup ForwardOperator {
  associativity: left
}

infix operator |>: ForwardOperator

func |> (lhs: MiddlewareProtocol, rhs: MiddlewareProtocol) -> MiddlewareProtocol {
  return lhs.link(with: rhs)
}

// –ø–æ—Å–ª–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ
let start = Middleware()
start
  |> NilValidation()
  |> CountValidation(length: 11)
  |> PhoneFormatterValidation(format: "+X (XXX) XXX XX-XX")

switch start.check(value: .value("79634481259")) {
case let .error(error): print(error)
case let .value(result): print(result ?? "")
}
{% endhighlight %}

–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å: <span class="wordcode">+7 (963) 448 02-09</span>

<br/>

---

## –í –∑–∞–∫–ª—é—á–µ–Ω–∏–∏

> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –º–æ–∂–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –Ω–µ –∑–∞–≤–∏—Å—è—â–∏—Ö –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏.

<br/>

**–ì–¥–µ –µ—â–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

* –†–µ–¥–∞–∫—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –Ω–∞–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–æ–ª—É—á–∏–º —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
* –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

#### –ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏—Ç–µ —Å—é–¥–∞ ‚Äì [@alobanov](https://twitter.com/alobanov)

[1]: https://github.com/alobanov/ExampleArticleComposite/tree/master/chainOfResponsibilityValidation/chainOfResponsibilityValidation.playground
[2]: https://gist.github.com/alobanov/30dec2f118532b4cc32d82bc321ac1bd
[5]: https://ru.wikipedia.org/wiki/%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B0_%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B5%D0%B9
